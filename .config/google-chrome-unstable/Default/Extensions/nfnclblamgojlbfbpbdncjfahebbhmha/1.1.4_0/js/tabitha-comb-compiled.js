var monNumToText="January February March April May June July August September October November December".split(" "),dayNumToText="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ");function checkURL(a){return"undefined"===typeof a||/^chrome/.test(a)||/^about:blank/.test(a)?!0:!1}function getDateStamp(a){a=new Date(a);var b=a.getUTCDay(),c=a.getUTCDate(),e=a.getUTCMonth(),h=a.getUTCFullYear();return dayNumToText[b]+", "+monNumToText[e]+" "+c+", "+h+" - "+a.toLocaleTimeString()}
function cleanUp(a){var b=$(a).parent().parent();b.fadeOut("fast",function(){var a=b.attr("created");b.remove();checkEmpty();chrome.runtime.sendMessage({command:"removeComb",time:a})})}function checkEmpty(){return $("#combined").is(":empty")?($("#combined").empty().html("<br><br><div class='notif'>You don't have any combined tabs yet.<br><br>Shame - had a girl all excited.</div>").fadeIn(),!0):!1}
function createAllButton(a,b,c){var e=document.createElement("div");e.setAttribute("class","allOption "+a);e.setAttribute("title",b);e.innerHTML=c;return e}
function addCombined(){var a=localStorage.getItem("combinedTabs"),a=JSON.parse(a);if(0===Object.keys(a).length)return $("#combined").empty().html("<br><br><div class='notif'>You don't have any combined tabs yet.<br><br>Shame - had a girl all excited.</div>").fadeIn(),!1;$("#combined").empty();var b=document.getElementById("combined"),c;for(c in a){var e=document.createElement("div");e.setAttribute("class","holder");e.setAttribute("created",c);var h=document.createElement("h3");h.setAttribute("class",
"infoHead");var g=document.createElement("div"),d=a[c].title||"Untitled";40<d.length&&(d=d.substring(0,40)+" &#8230");g.innerHTML=d;g.setAttribute("class","nameHead");g.setAttribute("title","Click here to give this group a title");d=document.createElement("div");d.setAttribute("class","optionsHolder");var k=createAllButton("close","Remove group","Remove"),l=createAllButton("restore","Restore group","Restore"),f=createAllButton("book","Bookmark & remove group","Bookmark");$(l).on("click",function(){for(var a=
$(this).parent().siblings(".tabBox"),b=0;b<a.length;b++){var c=$(a[b]).attr("url");chrome.tabs.create({url:c,active:!1})}cleanUp(this)});$(f).on("click",function(){for(var a=$(this).parent().siblings(".tabBox"),b=0;b<a.length;b++){var c=$(a[b]).attr("url"),d=$(a[b]).attr("tabtitle");pushBookmark(d,c)}cleanUp(this)});$(k).on("click",function(){cleanUp(this)});$(g).on("click",function(){if($(this).hasClass("giveName"))return!1;$("#combined").find(".nameHead.giveName").not(this).each(function(a){dumpFieldData(this)});
$(this).addClass("giveName");$(this).attr("old",$(this).html());$(this).html("<input class='getInput'>");var a=$(this).find(".getInput");a.val($(this).attr("old"));a.focus();a.select()});$(g).keypress(function(a){13==a.which&&dumpFieldData(this)});h.innerHTML=getDateStamp(c);d.appendChild(k);d.appendChild(f);d.appendChild(l);e.appendChild(d);e.appendChild(g);e.appendChild(h);h=a[c].tabData;for(g=0;g<h.length;g++)f=h[g][0],d=h[g][1],k=h[g][2],d=d.replace(/[<>]/g,""),l="default.png","undefined"===f||
checkURL(k)||(l=f),90<=d.length&&(d=d.substring(0,90)+" &#8230"),f=document.createElement("div"),f.setAttribute("url",k),f.setAttribute("class","tabBox"),f.setAttribute("tabtitle",d),f.setAttribute("title","Click to restore this tab.\n\n"+d+"\n\n"+k),f.innerHTML="<img class='boxIcon' src='"+l+"' width='16' height='16'>"+d,$(f).on("click",function(){var a=$(this).siblings("div.tabBox").length,b=$(this).parent().attr("created");if(0===a){var c=$(this).parent();c.fadeOut("fast",function(){c.remove();
checkEmpty()});checkEmpty();chrome.runtime.sendMessage({command:"removeComb",time:b})}else chrome.runtime.sendMessage({command:"removeSingle",time:b,ind:$(this).index()-3});a=$(this).attr("url");$(this).fadeOut("fast",function(){$(this).remove()});chrome.tabs.create({url:a,active:!1})}),e.appendChild(f);$(b).prepend(e)}}function hoverClose(a,b){$(a).hover(function(){$(b).css("visibility","visible")},function(){$(b).css("visibility","hidden")})}
function pushBookmark(a,b){var c=chrome.extension.getBackgroundPage().bookmarkDir;chrome.bookmarks.create({parentId:c,title:a,url:b})}chrome.runtime.onMessage.addListener(function(a,b,c){if("append"===a.command)addCombined();else return!1});function dumpFieldData(a){var b=$(a).find(".getInput").val();$(a).removeClass("giveName");if(b.length){40<b.length&&(b=b.substring(0,40)+" &#8230");var c=$(a).parent().attr("created");updateTitleInStorage(c,b)}else b=$(a).attr("old");$(a).html(b)}
function updateTitleInStorage(a,b){var c=localStorage.getItem("combinedTabs"),c=JSON.parse(c);c[a].title=b;localStorage.setItem("combinedTabs",JSON.stringify(c))}$("body").on("click",function(a){if($(a.target).is(".nameHead"))return a.preventDefault(),!1;$("#combined").find(".nameHead.giveName").each(function(a){dumpFieldData(this)})});document.title="Combined Tabs - Tabitha";addCombined();
