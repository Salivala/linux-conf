var allTabsCount=0,activeTabs={},retainedTabs=JSON.parse(localStorage.getItem("retain")),sortStyle="descending",clearRecent=!0,bookmarkDir=null,emptyInterval=12E5,highTabs=50,clearOldCombine=!0;function getAllTabs(a){chrome.windows.getLastFocused({populate:!0},function(b){currentTabs=b.tabs;a(b)})}function countAllTabs(a){allTabsCount=a=a.tabs.length;updateBadge(a)}function setColor(a){chrome.browserAction.setBadgeBackgroundColor({color:a})}
function updateBadge(a){chrome.browserAction.setBadgeText({text:a.toString()});a>=highTabs?setColor("#dd4b39"):a>=highTabs/2?setColor("#e67e22"):setColor("#27ae60")}function checkExists(a){for(var b=0;b<a.length;b++)if(/^Tabitha - Unsorted/.test(a[b].title))return!0;return!1}function checkURL(a){return!a||"undefined"===typeof a||/^chrome/.test(a)||/^about:blank/.test(a)?!1:!0}function tabInfo(a){this.id=a.id;this.url=a.url;this.title=a.title;this.favicon=a.favIconUrl}
chrome.runtime.onInstalled.addListener(function(){chrome.tabs.query({},function(a){for(var b=0;b<a.length;b++)void 0!==a[b]&&checkURL(a[b].url)&&(activeTabs[a[b].id]=new tabInfo(a[b]))});retainedTabs={};localStorage.setItem("retain",JSON.stringify({}));localStorage.setItem("combinedTabs",JSON.stringify({}));chrome.storage.sync.set({sort_choice:"descending",clr_combine:!0,clr_recent:!0})});chrome.tabs.onUpdated.addListener(function(a,b,c){checkURL(c.url)&&(activeTabs[c.id]=new tabInfo(c))});
chrome.tabs.onCreated.addListener(function(a){if(void 0===a)return!1;getAllTabs(countAllTabs);checkURL(a.url)&&(activeTabs[a.id]=new tabInfo(a))});
chrome.runtime.onMessage.addListener(function(a,b,c){if("remove"===a.command){if(void 0===retainedTabs[a.id])return!1;delete retainedTabs[a.id];localStorage.setItem("retain",JSON.stringify(retainedTabs))}else if("removeComb"===a.command){b=localStorage.getItem("combinedTabs");b=JSON.parse(b);if(void 0===b[a.time])return!1;delete b[a.time];localStorage.setItem("combinedTabs",JSON.stringify(b))}else if("removeSingle"===a.command){b=localStorage.getItem("combinedTabs");b=JSON.parse(b);if(void 0===b[a.time].tabData[a.ind])return!1;
b[a.time].tabData.splice([a.ind],1);localStorage.setItem("combinedTabs",JSON.stringify(b))}else"update_settings"===a.command&&(sortStyle=a.data.sort_choice,clearRecent=a.data.clr_recent,clearOldCombine=a.data.clr_combine)});chrome.windows.onFocusChanged.addListener(function(a){getAllTabs(countAllTabs)});
chrome.tabs.onRemoved.addListener(function(a,b){getAllTabs(countAllTabs);if(void 0===activeTabs[a])return!1;checkURL(activeTabs[a].url)&&(retainedTabs[a]=activeTabs[a],retainedTabs[a].timeClosed=new Date,localStorage.setItem("retain",JSON.stringify(retainedTabs)));delete activeTabs[a]});
function checkEmpty(){if(clearRecent){for(key in retainedTabs){var a=new Date,a=a-retainedTabs[key].timeClosed;108E5<=a&&delete retainedTabs[key]}localStorage.setItem("retain",JSON.stringify(retainedTabs))}if(clearOldCombine){var b=JSON.parse(localStorage.getItem("combinedTabs"));for(key in b)a=new Date,a-=new Date(key),6048E5<=a&&delete b[key];localStorage.setItem("combinedTabs",JSON.stringify(b))}}getAllTabs(countAllTabs);window.setInterval(checkEmpty,emptyInterval);
