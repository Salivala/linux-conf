"use strict";window.default_config={analytics_account:"UA-16944395-23",first_run:!0,auto_hibernate_after:15,wake_up_on_focus:!0,transparent_favicon:.45,tab_screenshot:!1,scan_tabs_interval:6e5};var ONE_SECOND=1e3,ONE_MINUTE=60*ONE_SECOND,FIVE_MINUTES=5*ONE_MINUTE,TEN_MINUTES=10*ONE_MINUTE,ONE_HOUR=60*ONE_MINUTE,app=angular.module("app",[]),bg=chrome.extension.getBackgroundPage();app.constant("bg",bg),bg.config.angularService(app),app.run(["$rootScope","config",function(n,e){n.config=e._config(),n.extensionVersion=chrome.app.getDetails().version}]),app.service("idb",["$q","bg",function(n,e){function t(e){return n(function(n,t){o.getAll(e,function(e,i){e?t(e):n(i)})})}function i(e,t){return n(function(n,i){o.set(e,t,function(e,t){e?i(e):n(t)})})}function r(e,t){return n(function(n,i){o.set(e,t,function(e,t){e?i(e):n(t)})})}var o=e.idb;return{getAll:t,set:i,remove:r}}]),app.controller("MainCtrl",["$scope","$q","$timeout","idb","config","bg",function(n,e,t,i,r,o){function a(){chrome.tabs.query({},function(e){n.hibernatingTabs=e.filter(function(n){return-1!==n.url.indexOf(f)}),n.tabs=e})}function c(){return e(function(e,t){chrome.tabs.query({active:!0},function(i){if(0===i.length)return t();var r=i[0],o=r.url;if(n.currentHibernating=r,-1!==o.indexOf(f)){n.currentHibernating=null;var c={};r.url.split("?")[1].split("&").forEach(function(n){var e=n.split("=");c[e[0]]=e[1]}),o=decodeURIComponent(c.originalUrl)}a(),e(o)})})}var u=void 0,f=chrome.extension.getURL("");n.mode=!1,c().then(function(e){n.tabURL=e;var t=document.createElement("a");t.href=e,n.hostname=t.hostname.replace("www.",""),i.getAll("IGNORED_LIST").then(function(e){for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];if(new RegExp(i.regexp).test(n.tabURL)){n.mode=i.mode,n.result=i;break}}})}),n.modeChangeHandler=function(){switch(n.mode){case"hostname":u={id:u?u.id:null,mode:"hostname",regexp:"(.*)"+n.hostname},i.set("IGNORED_LIST",u).then(function(n){u.id=n});break;case"page":u={id:u?u.id:null,mode:"page",regexp:n.tabURL},i.set("IGNORED_LIST",u).then(function(n){u.id=n});break;default:u&&u.id&&i.remove("IGNORED_LIST",u.id)}},n.settingsUpdate=function(n,e){r.set(n,e)},n.hibernateThis=function(){o.hibernateTab(n.currentHibernating,function(){return t(c,500)})},n.hibernateAll=function(){chrome.tabs.query({},function(n){n.forEach(function(n){-1===n.url.indexOf(f)&&o.hibernateTab(n,c)}),t(c,500)})},n.wakeupAll=function(){chrome.tabs.query({url:f+"hibernate.html*"},function(n){n.forEach(function(n){chrome.tabs.sendMessage(n.id,{action:"wakeup",tabID:n.id},function(){})})})}}]);