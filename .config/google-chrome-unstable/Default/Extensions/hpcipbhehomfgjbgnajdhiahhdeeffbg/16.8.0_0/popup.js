var isMac=-1!=navigator.platform.indexOf("Mac"),backgroundPage=chrome.extension.getBackgroundPage(),optionsEnabled=null!=backgroundPage&&backgroundPage.optionsEnabled(),windowWidth=222,windowHeight=isMac?188:194,sharingStates={NONE:"none",STARTING:"starting",SHARING:"sharing",PAUSED:"paused",CONNECTING:"connecting",RECONNECTING:"reconnecting"},startScreenShareAfterSignin=!1,startBroadcastAfterSignin=!1,isContentLoaded=!1;function bindExternalLinksListeners(){document.getElementById("screenshotsLink").parentNode.onclick=function(){backgroundPage.viewScreenshots(),closePopupWindow()},document.getElementById("screenleapLink").parentNode.onclick=function(){backgroundPage.viewScreenleapSite(),closePopupWindow()},document.getElementById("signupLink").onclick=function(){backgroundPage.openSignup(),closePopupWindow()}}function updateUI(e,n){e?(n||(n=backgroundPage.getOption("emailAddress")),chrome.browserAction.setIcon({path:"screenleap_icon_19_19.png"}),document.getElementById("screenshotsLink").parentNode.style.display="",document.getElementById("signInLink").parentNode.style.display="none",document.getElementById("signOutLink").title="Sign out of your "+n+" account",document.getElementById("signOutLink").parentNode.style.display="",document.getElementById("privateBrowserShareLink").parentNode.className="menu-row",document.getElementById("privateScreenShareLink").parentNode.className="menu-row",document.getElementById("broadcastBrowserLink").parentNode.className="menu-row",document.getElementById("broadcastScreenLink").parentNode.className="menu-row",updateWindowDimensions()):(chrome.browserAction.setIcon({path:"screenleap_icon_19_19_off.png"}),document.getElementById("screenshotsLink").parentNode.style.display="none",document.getElementById("signInLink").parentNode.style.display="",document.getElementById("signOutLink").parentNode.style.display="none",document.getElementById("privateBrowserShareLink").parentNode.className="menu-row disabled",document.getElementById("privateScreenShareLink").parentNode.className="menu-row disabled",document.getElementById("broadcastBrowserLink").parentNode.className="menu-row disabled",document.getElementById("broadcastScreenLink").parentNode.className="menu-row disabled",updateWindowDimensions())}function showOption(e,n){var t=document.getElementById(e);t.parentNode.parentNode.style.display="",backgroundPage.presenter.getOption(n)&&(t.checked=!0),t.onclick=function(){setPresenterOption(n,t.checked)}}function setPresenterOption(e,n){backgroundPage.presenter.setOption(e,n)}function toggleSpecialPageMenu(){backgroundPage.presenter.isProduction||showOption("restrictToTab",backgroundPage.presenter.RESTRICT_TO_TAB),backgroundPage.presenter.isProduction||showOption("restrictToFirstWindow",backgroundPage.presenter.RESTRICT_TO_FIRST_WINDOW),chrome.tabs.query({currentWindow:!0,active:!0},function(e){var n=e[0];n&&0==n.url.indexOf("chrome")?(document.getElementById("screenshotDisabledNote").style.display="block",document.getElementById("screenshotLinkDiv").style.display="none",document.getElementById("shareLinkDiv").style.display="none"):n&&0==n.url.indexOf("https://chrome.google.com/webstore/")&&(document.getElementById("regionScreenshotLink").parentNode.className+=" disabled")})}function updateWindowDimensions(){var e=windowWidth;""==document.getElementById("signInPanel").style.display?e=282:""==document.getElementById("sharing").style.display&&(e=264),document.body.style.width=e+"px"}function clearWindowDimensions(){document.body.style.width="inherit"}function updateUIAndClosePopupWindow(e){closePopupWindow()}function closePopupWindow(){window&&window.close()}function showSignin(e){document.getElementById("screenleapMenuOptions").style.display="none",document.getElementById("signInPanel").style.display="";var n=document.getElementById("emailAddress");n.value?document.getElementById("password").focus():n.focus();var t=document.getElementById("signinPanelMessage");e?(t.textContent=e,t.style.display=""):t.style.display="none",updateWindowDimensions()}function bindSignInEventListeners(){document.getElementById("signInLink").parentNode.onclick=function(){showSignin()},document.getElementById("signOutLink").parentNode.onclick=function(){closePopupWindow(),backgroundPage.doSignOut()},document.getElementById("signInButton").onclick=function(e){e.target.className&&-1!=e.target.className.indexOf("disabled")||(e.target.className=e.target.className+" disabled",document.getElementById("signInIndicator").style.visibility="visible",document.getElementById("cancelButton").style.display="none",document.getElementById("screenleapMessage").style.display="none",backgroundPage.signIn(document.getElementById("emailAddress").value,document.getElementById("password").value,function(){startScreenShareAfterSignin?(updatePresenterControlPanelUI(sharingStates.STARTING),resetSignInPanel(),clearWindowDimensions(),backgroundPage.startScreenShareForUser()):startBroadcastAfterSignin?(updatePresenterControlPanelUI(sharingStates.STARTING),resetSignInPanel(),clearWindowDimensions(),backgroundPage.startBroadcastForUser()):(closePopupWindow(),backgroundPage.dispatch.triggerOnActiveTab("showSignInSuccessfulDialog"))},null))},document.getElementById("cancelButton").onclick=function(){document.getElementById("screenleapMenuOptions").style.display="",resetSignInPanel(),updateWindowDimensions()}}function resetSignInPanel(){document.getElementById("signInPanel").style.display="none",document.getElementById("signInIndicator").style.visibility="hidden",document.getElementById("cancelButton").style.display="",document.getElementById("signInButton").className="screenleap-flat-button screenleap-green",document.getElementById("password").value="",startScreenShareAfterSignin=!1,startBroadcastAfterSignin=!1}function bindScreenshotListeners(){document.getElementById("regionScreenshotLink").parentNode.onclick=function(e){-1==e.target.className.indexOf("disabled")&&(backgroundPage.regionScreenshot(null,null),closePopupWindow())},document.getElementById("windowScreenshotLink").parentNode.onclick=function(e){-1==e.target.className.indexOf("disabled")&&(backgroundPage.capture(),closePopupWindow())},optionsEnabled&&(document.getElementById("options").style.display="",initCheckboxOption("autoCapture"),initCheckboxOption("editOnCapture"))}function initCheckboxOption(e){var n=document.getElementById(e);backgroundPage.getOption(e)&&(n.checked="checked"),n.onclick=function(n){backgroundPage.setOption(e,n.target.checked),"editOnCapture"!=e||n.target.checked||(backgroundPage.setOption("autoCapture",!1),document.getElementById("autoCapture").checked=!1)}}function bindScreenShareListeners(){var e=document.getElementById("privateBrowserShareLink").parentNode;e.onclick=function(){setPresenterOption("shareEntireScreen",!1),-1==e.className.indexOf("disabled")?(updatePresenterControlPanelUI(sharingStates.STARTING),clearWindowDimensions(),backgroundPage.startScreenShareForUser()):(startScreenShareAfterSignin=!0,showSignin("You must sign in to start sharing."))};var n=document.getElementById("privateScreenShareLink").parentNode;n.onclick=function(){setPresenterOption("shareEntireScreen",!0),-1==n.className.indexOf("disabled")?(updatePresenterControlPanelUI(sharingStates.STARTING),clearWindowDimensions(),backgroundPage.startScreenShareForUser()):(startScreenShareAfterSignin=!0,showSignin("You must sign in to start sharing."))}}function bindBroadcastListeners(){var e=document.getElementById("broadcastBrowserLink").parentNode;e.onclick=function(){setPresenterOption("shareEntireScreen",!1),-1==e.className.indexOf("disabled")?(updatePresenterControlPanelUI(sharingStates.STARTING),clearWindowDimensions(),backgroundPage.startBroadcastForUser()):(startBroadcastAfterSignin=!0,showSignin("You must sign in to start broadcasting."))};var n=document.getElementById("broadcastScreenLink").parentNode;n.onclick=function(){setPresenterOption("shareEntireScreen",!0),-1==n.className.indexOf("disabled")?(updatePresenterControlPanelUI(sharingStates.STARTING),clearWindowDimensions(),backgroundPage.startBroadcastForUser()):(startBroadcastAfterSignin=!0,showSignin("You must sign in to start broadcasting."))}}document.addEventListener("DOMContentLoaded",function(){(isContentLoaded=!0,document.getElementById("screenleapExtensionMenu").className="screenleap-chrome screenleap-webkit",backgroundPage.presenter.sharingState==sharingStates.NONE)?(updateUI(backgroundPage.getIsAuthenticated(),null,null),toggleSpecialPageMenu(),bindScreenshotListeners(),bindScreenShareListeners(),bindBroadcastListeners(),bindSignInEventListeners(),bindExternalLinksListeners()):initSharingUI(backgroundPage.presenter.sharingState,backgroundPage.presenter.screenShareInfo&&backgroundPage.presenter.screenShareInfo.hidePauseButton,backgroundPage.presenter.screenShareInfo&&backgroundPage.presenter.screenShareInfo.hideStopButton,backgroundPage.presenter.getHideViewerUrl()?null:backgroundPage.presenter.getViewerUrl())});const qualityOptions=[[20,999],[30,999],[40,999],[999,999]],throttleOptions=[1e3,500,250,100,0];function initSharingUI(e,n,t,o,a){updatePresenterControlPanelUI(e,o);var s=document.getElementById("slowNetwork");backgroundPage.presenter.isNetworkSlow?s.style.display="inline":s.style.display="none",updatePauseButton(e);var r=document.getElementById("pauseButton");r&&(r.onclick=function(){backgroundPage.presenter.togglePause()},r.style.display=n?"none":"");var i=document.getElementById("stopButton");i&&(document.getElementById("stopButton").onclick=function(){backgroundPage.presenter.stopScreenleap(!0,!0,"USER_ACTION")},i.style.display=t?"none":"");const d=document.getElementById("quality");if(d){const e=function(){const e=parseInt(d.value);if(e>=qualityOptions.length)return void console.log("Quality slider is "+parseInt(e)+"must be less than "+qualityOptions.length);const n=qualityOptions[e];parseInt(n[0])>100?captureFormat="png":captureFormat="jpeg",backgroundPage.presenter.setImageQualityBounds(parseInt(n[0]),parseInt(n[1]))};d.onchange=e}const c=document.getElementById("throttle");if(c){const e=function(){const e=parseInt(c.value);e>=throttleOptions.length?console.log("Throttle slider is "+parseInt(e)+"must be less than "+throttleOptions.length):backgroundPage.presenter.setFrameDelayMS(throttleOptions[e])};c.onchange=e}const l=document.getElementById("popupAdvanced");if(l){const e=document.getElementById("popupShowAdvanced"),n=document.getElementById("popupHideAdvanced");e.onclick=function(){const t=backgroundPage.presenter.screenShareInfo.baseImageQuality,o=backgroundPage.presenter.getMaxImageQualityForCurrentViewport(48e4);let a=2;for(let e=0;e<qualityOptions.length;e++)if(t==qualityOptions[e][0]&&o==qualityOptions[e][1]){a=e;break}d.value=a;const s=backgroundPage.presenter.getFrameDelay();let r=throttleOptions.length;for(let e=0;e<throttleOptions.length;e++)if(s==throttleOptions[e]){r=e;break}return c.value=r,l.style="display: block;",e.style="display: none;",n.style="display: block;",!1},n.onclick=function(){return l.style="display: none;",e.style="display: block;",n.style="display: none;",!1}}document.getElementById("sharingInstructionsButton")&&(document.getElementById("sharingInstructionsButton").onclick=function(){backgroundPage.dispatch.triggerOnActiveTab("showSharingInstructions",{webServerHostname:backgroundPage.presenter.webServerHostname,screenShareCode:backgroundPage.presenter.getScreenShareCode(),handle:backgroundPage.presenter.getHandle(),viewerUrl:backgroundPage.presenter.getViewerUrl(),activeViewers:backgroundPage.presenter.activeViewers}),closePopupWindow()}),document.getElementById("viewerUrl")&&(document.getElementById("viewerUrl").onclick=function(e){e.target.select(),backgroundPage.copyToClipboard(this.value)}),a&&setTimeout(function(){closePopupWindow()},8e3)}function updatePresenterControlPanelUI(e,n){e==sharingStates.NONE?(document.getElementById("loading")&&(document.getElementById("loading").style.display="none"),document.getElementById("sharing")&&(document.getElementById("sharing").style.display="none"),document.getElementById("screenleapMenuOptions")&&(document.getElementById("screenleapMenuOptions").style.display=""),document.getElementById("presenterControlPanel")&&(document.getElementById("presenterControlPanel").style.display="none"),updatePauseButton(e)):(document.getElementById("screenleapMenuOptions")&&(document.getElementById("screenleapMenuOptions").style.display="none"),document.getElementById("presenterControlPanel")&&(document.getElementById("presenterControlPanel").style.display=""),e==sharingStates.STARTING?(document.getElementById("loading")&&(document.getElementById("loading").style.display=""),document.getElementById("sharing")&&(document.getElementById("sharing").style.display="none")):(document.getElementById("loading")&&(document.getElementById("loading").style.display="none"),document.getElementById("sharing")&&(document.getElementById("sharing").style.display=""),document.getElementById("viewerUrl")&&(n?(document.getElementById("viewerUrl").style.display="",document.getElementById("viewerUrl").value=n):document.getElementById("viewerUrl").style.display="none"),updatePauseButton(e)))}function updatePauseButton(e){var n=document.getElementById("state");if(n)if(e==sharingStates.RECONNECTING)n.textContent="reconnecting",n.setAttribute("class","screenleap-red");else{var t=document.getElementById("pauseButton");n.textContent=e==sharingStates.PAUSED?"PAUSED":e==sharingStates.CONNECTING?"CONNECTING":"SHARED",t.textContent=e==sharingStates.PAUSED?"Resume sharing":"Pause sharing",t.className=e==sharingStates.PAUSED?"screenleap-flat-button screenleap-green":"screenleap-flat-button screenleap-orange",n.setAttribute("class","")}}function updateStatusLabel(e){document.getElementById("sharingStatus").innerHTML=e}function resetExtension(e){console.log("RESETTING EXTENSION: "+e),backgroundPage.resetExtension(),updatePresenterControlPanelUI(sharingStates.NONE,null,!0)}